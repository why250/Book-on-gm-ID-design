% Example 2.2 reconstruct CSM ID by means of EKV modelclear all;close all;addpath ../../lib% technology data  --------------------------T   = 300;                    	% temperature °KN   = 1e17;                    	% doping conc. cm^-3tox = 5;                        % oxide thickness nmVFB = .6;                       % flat-band voltage VVS  = 0;                       	% source voltage VVG  = linspace(0.0,2,100)';  	% gate voltage VVD  = 2;                     	% drain voltage V (saturated transistor)% all voltages are expressed with respect to the substrate% compute pMat (see annex A2.1.1) --------------------- p  = pMat(T,N,tox);UT = p(3,1); gam = p(2,1); K = p(4,1); % compute CSM -------------------------------UG = VG + VFB;VS = VS*ones(length(VG),1);VD = VD*ones(length(VG),1);psiS = surfpot(p,VS,UG);    %(equ. A2.1.2)psiD = surfpot(p,VD,UG);A1 = [-.5 -2/3*gam 0 0 0];  %(annex A2.1.3, equ. 2.22 and 2.23)ID1 = K*(polyval(A1,sqrt(psiD)) - polyval(A1,sqrt(psiS)) + UG.*(psiD- psiS));A2 = [UT gam*UT 0];ID2 = K*(polyval(A2,sqrt(psiD)) - polyval(A2,sqrt(psiS)));ID = IDsh(p,VS,VD,VG+VFB);gm_ID = diff(log(ID))./diff(UG);X = .5*(UG(1:end-1) + UG(2:end)) - VFB;% EKV param extract ================GM_ID = 3;  % best second reference pointM     = max(gm_ID);n     = 1/(M*UT); [a b] = min(abs(gm_ID-GM_ID));q     = M/gm_ID(b) -1VP    = UT*(2*(q-1) + log(q));VT    = VG(b) - n*VP;IS    = ID(b)/(q^2+q); % EKV reconstruct ================qS  = logspace(-6,2,20);IDD = IS*(qS.^2 + qS);VPr = UT*(2*(qS-1) + log(qS));VGS = n*VPr + VT; % plot ----------------------------------------h1 = figure(1);semilogy(VG(b),ID(b),'ok',VG,ID,'k',VGS,IDD,'k+','linewidth',1.01);xlabel('{\itV_G_S}  (V)'); ylabel('{\itI_D}  (A)');axis([0 2 1e-15 1e-3]); grid%format_and_save(h1, 'Fig2_10')